<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.5.16/p5.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <style>
    body{ background-color: ivory; font-family: Helvetica; }
    #canvas{border:1px solid red;}
    </style>
  </head>
  <body>

    <canvas id="canvas" width='350' height='300'></canvas>
    <br>
    <button id='showCoords'>Show XY coordinates</button>
    <button id='showNum'>Show pitch coordinates</button>
    <br>
    <br>
    <div id='about'>
   Â©2017 Nathan Bloomfield All Rights Reserved
   <br>
   <br>
    This module provides an environment for visualization of harmonic structures on a 2-dimensional plane using HTML5 Canvas and JavaScript.
    It is intended for use as an educational tool for the demonstration of musical concepts in future applications as well as a being a vehicle for harmonic exploration.
    <br>
    <br>
    Instructions
    <ul>
    <li>Clicking 'Show XY Coordinates' toggles XY coords for each point. This gives the programmer a reference for precise, hassle-free drawing of lines from point A to point B even if the circle radius is resized.</li>
    <br>
    <li>Clicking 'Show Pitch Coordinates' toggles numbers 0-11, representing atonal pitch space with 0 as the fundamental.</li>
    </ul>
    <br>
    <br>
    Upcoming features:
    <ul>
    <li>Drawing UI (an augmented triad is currently hard-coded in)</li>
    <li>Map note names to each pitch coordinate</li>
    <li>Visualize whole and half-steps with arrows</li>
    <li>Integrate VexFlow for staff notation</li>
    <li>Use WebMIDI API for playback</li>
   </ul>

    </div>
    <script>
    let canvas = document.getElementById("canvas");
    let context = canvas.getContext("2d");


    let showXY = false;
    let showCoords = false;
    let toggleXY = false;
    let toggleNum = false;

    $('#showCoords').on('click', function(){
      if(!toggleXY){
      showXY = true;
      toggleXY = true;
      context.clearRect(0, 0, canvas.width, canvas.height);
      drawCircle();
    } else {
    showXY = false;
    toggleXY = false;
    context.clearRect(0, 0, canvas.width, canvas.height);
    drawCircle();
  }
    });

    $('#showNum').on('click', function(){
      if(!toggleNum){
      showCoords = true;
      toggleNum = true;
      context.clearRect(0, 0, canvas.width, canvas.height);
      drawCircle();
    } else {
    showCoords = false;
    toggleNum = false;
    context.clearRect(0, 0, canvas.width, canvas.height);
    drawCircle();

  }
    });


      //begin drawing function
      let drawCircle = function (){
      //number of dots
      let dotsPerCircle=12;
      //amount of dots along the edge of the circle
      let interval=(Math.PI*2)/dotsPerCircle;
      //position of entirety on the canvas
      let centerX=canvas.width/2;
      let centerY=canvas.height/2;
      //radius of the entire conglomerate
      let radius=120;

    for(let i=0;i<dotsPerCircle;i++){
        //spacial distribution of dots along circle
        desiredRadianAngleOnCircle = interval*(i+9);

        let x = Math.round(centerX+radius*Math.cos(desiredRadianAngleOnCircle));
        let y = Math.round(centerY+radius*Math.sin(desiredRadianAngleOnCircle));

         //draw circle
         context.beginPath();
         context.arc(x,y,2,0,Math.PI*2);
         //draw XY coords for each dot
         if(showXY){
         context.font = "12px Arial";
         context.fillText(`${x}, ${y}`,x,y);
         }
         //draw atonal coords for each note
         if(showCoords){
           context.font = "12px Arial";
           context.fillText(`${i}`,x,y);
         }
         context.fill();

    }
    //An augmented triad (equilateral triangle)
    context.moveTo(175, 30); //12 o'clock coordinates
    context.lineTo(71, 210);
    context.lineTo(279, 210);
    context.lineTo(175, 30);
    context.stroke();

  }
  //Initialize draw function
  drawCircle();


  function writeMessage(canvas, message) {
        var context = canvas.getContext('2d');
        context.clearRect(0, 0, canvas.width, canvas.height);
        drawCircle();
        context.font = '12pt Calibri';
        context.fillStyle = 'black';
        context.fillText(message, 10, 25);
      }
  function getMousePos(canvas, evt) {
          var rect = canvas.getBoundingClientRect();
          return {
            x: evt.clientX - rect.left,
            y: evt.clientY - rect.top
          };
        }
        canvas.addEventListener('click', function(evt) {
        var mousePos = getMousePos(canvas, evt);
        var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
        writeMessage(canvas, message);
        context.moveTo(175,30);
        context.lineTo(mousePos.x, mousePos.y);
        context.stroke();
      }, false);




    </script>
  </body>
</html>
